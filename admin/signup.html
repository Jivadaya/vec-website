<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Admin Access</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-light d-flex align-items-center justify-content-center" style="height: 100vh;">
    <div class="card p-4 shadow-sm" style="max-width: 450px; width: 100%;">
        <div class="text-center mb-4">
            <h4 class="fw-bold">Request Admin Access</h4>
            <p class="text-secondary small">Register your account and wait for Super Admin approval.</p>
        </div>

        <div id="message" class="alert d-none"></div>

        <form onsubmit="handleSignup(event)">
            <div class="mb-3">
                <label class="form-label fw-bold small text-secondary">Email Address</label>
                <input type="email" id="email" class="form-control" required placeholder="name@example.com">
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold small text-secondary">Password</label>
                <input type="password" id="password" class="form-control" required minlength="6" placeholder="••••••••">
            </div>

            <button class="btn btn-primary w-100 py-2 fw-bold">Register</button>
            <div class="text-center mt-3">
                <a href="index.html" class="small text-decoration-none">Back to Login</a>
            </div>
        </form>
    </div>

    <script type="module">
        import { config } from './js/config.js';
        const supabase = window.supabase.createClient(config.SUPABASE_URL, config.SUPABASE_KEY);

        window.handleSignup = async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msg = document.getElementById('message');

            msg.className = 'alert alert-info';
            msg.textContent = 'Registering...';
            msg.classList.remove('d-none');

            try {
                // 1. Sign Up (creates auth.users entry)
                // The Database Trigger will automatically create the 'profiles' entry
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (error) throw error;

                if (data.user) {
                    msg.className = 'alert alert-success';
                    msg.innerHTML = 'Registration successful! <br>Please wait for Super Admin approval.<br><a href="index.html" class="fw-bold">Go to Login</a>';
                    e.target.reset();
                }
            } catch (err) {
                msg.className = 'alert alert-danger';
                msg.textContent = 'Error: ' + err.message;
            }
        };
    </script>
</body>

</html>